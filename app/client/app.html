<head>
    <title>Secret Space Santa</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <div class="sss-heading">
        <h1>Secret Space Santa</h1>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <p class="bg-danger">
                    If you want to contribute to this project, check out 
                    <a href="https://github.com/jletellier/secret-space-santa">
                        this Git repository</a>
                    on Github.
                </p>
                
                {{> participant }}
                {{> admin }}
            </div>
            <div class="col-md-4">
                {{> statistics }}
                
                <div class="bg-warning sss-login">
                    {{> loginButtons }}
                    {{> settings }}
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade sss-share-item-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Share ID:</h4>
                </div>
                <div class="modal-body">
                    <span class="sss-share-item-modal-content"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade sss-change-date-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Set new target date:</h4>
                </div>
                <div class="modal-body">
                    <input type="datetime-local">
                    <span class="sss-item save-date glyphicon glyphicon-ok"></span>
                </div>
            </div>
        </div>
    </div>
</body>

<template name="statistics">
    {{# if queryGroup }}
        <div class="bg-danger">
            <p>Group name: <span class="text-danger">{{ queryGroup.name }}</span></p>
            <p>
                Event coming up 
                <span class="text-danger" title="{{ targetDate }}">{{ remaining }}</span>
                <span class="change-date sss-item glyphicon glyphicon-cog"></span>
            </p>
            <p>Participants: <span class="text-danger">{{ participantCount }}</span></p>
            <p>Participants drawn: <span class="text-danger">{{ drawnCount }}</span></p>
        </div>
    {{/ if }}
</template>

<template name="settings">
    {{# if queryGroup }}
        <a href="/">Show groups</a>
    {{/ if }}
</template>

<template name="participant">
    {{# if queryParticipant }}
        <div class="sss-user bg-warning">
            <p>Hi <span>{{ queryParticipant.name }}</span>,</p>
            <p>You are the Secret Santa for: <span class="user-drawn text-success">
                <strong>{{ queryParticipant.drawnParticipant }}</strong></span>.
            </p>
        </div>
    {{/ if }}
</template>

<template name="admin">
    <div class="sss-admin bg-warning">
        {{# if loggedIn }}
            <div class="clearfix">
                <div class="pull-left">
                    <h2>
                        {{# if queryGroup }} 
                            Santa Claus' Area
                        {{ else }}
                            Your Groups
                        {{/ if }}
                    </h2>
                </div>
                <div class="pull-right">
                    {{# if queryGroup }}
                        <button type="button" class="auto-assign btn btn-primary">
                            <span class="glyphicon glyphicon-random"></span>
                            Auto assign
                        </button>
                        <button type="button" class="add-item btn btn-success">
                            <span class="glyphicon glyphicon-plus-sign"></span>
                            Add participant
                        </button>
                    {{ else }}
                        <button type="button" class="add-group btn btn-success">
                            <span class="glyphicon glyphicon-plus-sign"></span>
                            Create group
                        </button>
                    {{/ if }}
                </div>
            </div>
            {{# if queryGroup }}
                {{> adminList }}
            {{ else }}
                {{> groupList }}
            {{/ if }}
        {{ else }}
            <p>Plase log in to manage your groups or to create a new group.</p>
        {{/ if }}
    </div>
</template>

<template name="groupList">
    <table class="table-striped">
        <thead><tr>
            <th>Group name</th>
            <th>Target Date</th>
            <th></th>
        </tr></thead>
        <tbody>
            {{# each groups }}
                {{> groupListItem }}
            {{/ each }}
        </tbody>
    </table>
</template>

<template name="groupListItem">
    <tr class="edit-item">
        <td><a href="{{ link }}">{{ name }}</a></td>
        <td>{{ targetDate }}</td>
        <td>
            <span class="sss-item remove-item glyphicon glyphicon-trash"></span>
        </td>
    </tr>
</template>

<template name="adminList">
    <table class="table-striped">
        <thead><tr>
            <th>Participant</th>
            <th>Drawn participant</th>
            <th></th>
        </tr></thead>
        <tbody>
            {{# each participants }}
                {{> adminListItem }}
            {{/ each }}
        </tbody>
    </table>
</template>

<template name="adminListItem">
    <tr>
        <td>{{ name }}</td>
        <td>
            {{# if reveal }}
                <select class="form-control">
                    <option>{{ drawnParticipant }}</option>
                    {{# each freeParticipants }}
                        <option>{{ name }}</option>
                    {{/ each }}
                </select>
            {{ else }}
                <span class="glyphicon glyphicon-user"></span> (hidden)
            {{/ if }}
        </td>
        <td>
            <span class="sss-item reveal-item glyphicon
                {{# if reveal }}glyphicon-eye-close{{ else }}glyphicon-eye-open{{/ if }}">
            </span>
            <span class="sss-item remove-item glyphicon glyphicon-trash"></span>
            <span class="sss-item share-item glyphicon glyphicon-share"></span>
        </td>
    </tr>
</template>
